<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>probplots-web</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-900">
  <main class="max-w-6xl mx-auto p-6 space-y-6">
    <!-- Header with ⓘ About -->
    <header class="flex items-center justify-between">
      <h1 class="text-2xl font-bold">probplots-web</h1>
      <div class="flex items-center gap-3">
        <nav class="space-x-3 text-xs">
          <a class="underline" href="/healthz">/healthz</a>
          <a class="underline" href="/docs">/docs</a>
          <a class="underline" href="/about">/about</a>
        </nav>
        <button id="btn-about" title="About"
          class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-slate-900 text-white hover:bg-slate-800 focus:outline-none"
          aria-label="About">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <circle cx="12" cy="12" r="9" stroke-width="1.5"></circle>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
              d="M12 8.5h.01M11 11h1v5h1" />
          </svg>
        </button>
      </div>
    </header>

    <!-- Grid of cards -->
    <section class="grid lg:grid-cols-2 gap-6">

      <!-- NORMAL -->
      <div class="p-4 rounded-xl bg-white shadow">
        <h3 class="font-semibold mb-3">Normal</h3>
        <form id="f-ncdf" class="grid grid-cols-2 gap-2 items-end">
          <label class="text-sm">x<input class="border p-2 rounded w-full" name="x" value="1.96"></label>
          <label class="text-sm">μ<input class="border p-2 rounded w-full" name="mu" value="0"></label>
          <label class="text-sm">σ<input class="border p-2 rounded w-full" name="sigma" value="1"></label>
          <button class="px-3 py-2 rounded bg-slate-900 text-white" type="submit">CDF Φ(x)</button>
        </form>
        <form id="f-ninv" class="grid grid-cols-2 gap-2 items-end mt-3">
          <label class="text-sm">p (0–1)<input class="border p-2 rounded w-full" name="p" value="0.975"></label>
          <label class="text-sm">μ<input class="border p-2 rounded w-full" name="mu" value="0"></label>
          <label class="text-sm">σ<input class="border p-2 rounded w-full" name="sigma" value="1"></label>
          <button class="px-3 py-2 rounded bg-slate-900 text-white" type="submit">Inverse Φ⁻¹(p)</button>
        </form>
        <div class="mt-3 text-xs"><pre id="r-norm" class="whitespace-pre-wrap break-all"></pre></div>
        <div class="mt-3">
          <button id="btn-npdf" class="px-3 py-2 rounded bg-slate-900 text-white text-sm">Show Normal PDF</button>
          <img id="img-npdf" class="mt-3 rounded border hidden" alt="normal pdf"/>
        </div>
      </div>

      <!-- BINOMIAL -->
      <div class="p-4 rounded-xl bg-white shadow">
        <h3 class="font-semibold mb-3">Binomial</h3>
        <form id="f-bpmf" class="grid grid-cols-3 gap-2 items-end">
          <label class="text-sm">n<input class="border p-2 rounded w-full" name="n" value="20"></label>
          <label class="text-sm">p<input class="border p-2 rounded w-full" name="p" value="0.5"></label>
          <label class="text-sm">k<input class="border p-2 rounded w-full" name="k" value="10"></label>
          <button class="px-3 py-2 rounded bg-slate-900 text-white col-span-3" type="submit">PMF P(X=k)</button>
        </form>
        <form id="f-bcdf" class="grid grid-cols-3 gap-2 items-end mt-3">
          <label class="text-sm">n<input class="border p-2 rounded w-full" name="n" value="20"></label>
          <label class="text-sm">p<input class="border p-2 rounded w-full" name="p" value="0.5"></label>
          <label class="text-sm">k<input class="border p-2 rounded w-full" name="k" value="12"></label>
          <button class="px-3 py-2 rounded bg-slate-900 text-white col-span-3" type="submit">CDF P(X≤k)</button>
        </form>
        <form id="f-bcdf-range" class="grid grid-cols-4 gap-2 items-end mt-3">
          <label class="text-sm">n<input class="border p-2 rounded w-full" name="n" value="20"></label>
          <label class="text-sm">p<input class="border p-2 rounded w-full" name="p" value="0.5"></label>
          <label class="text-sm">kmin<input class="border p-2 rounded w-full" name="kmin" value="8"></label>
          <label class="text-sm">kmax<input class="border p-2 rounded w-full" name="kmax" value="12"></label>
          <button class="px-3 py-2 rounded bg-slate-900 text-white col-span-4" type="submit">P(kmin ≤ X ≤ kmax)</button>
        </form>
        <div class="mt-3 text-xs"><pre id="r-binom" class="whitespace-pre-wrap break-all"></pre></div>
        <div class="mt-3">
          <button id="btn-binom-sim" class="px-3 py-2 rounded bg-slate-900 text-white text-sm">Show Binomial Simulation</button>
          <img id="img-binom" class="mt-3 rounded border hidden" alt="binomial sim"/>
        </div>
      </div>

      <!-- POISSON -->
      <div class="p-4 rounded-xl bg-white shadow">
        <h3 class="font-semibold mb-3">Poisson</h3>
        <form id="f-ppmf" class="grid grid-cols-2 gap-2 items-end">
          <label class="text-sm">λ<input class="border p-2 rounded w-full" name="lam" value="3"></label>
          <label class="text-sm">k<input class="border p-2 rounded w-full" name="k" value="2"></label>
          <button class="px-3 py-2 rounded bg-slate-900 text-white col-span-2" type="submit">PMF/CDF</button>
        </form>
        <div class="mt-3">
          <button id="btn-pois-sim" class="px-3 py-2 rounded bg-slate-900 text-white text-sm">Show Poisson Simulation</button>
          <img id="img-pois" class="mt-3 rounded border hidden" alt="poisson sim"/>
        </div>
        <div class="mt-3 text-xs"><pre id="r-pois" class="whitespace-pre-wrap break-all"></pre></div>
      </div>

      <!-- GEOMETRIC / EXP / UNIFORM -->
      <div class="p-4 rounded-xl bg-white shadow space-y-4">
        <h3 class="font-semibold">Other</h3>

        <form id="f-geom" class="grid grid-cols-2 gap-2 items-end">
          <label class="text-sm">p<input class="border p-2 rounded w-full" name="p" value="0.3"></label>
          <label class="text-sm">k (failures)<input class="border p-2 rounded w-full" name="k" value="2"></label>
          <button class="px-3 py-2 rounded bg-slate-900 text-white col-span-2" type="submit">Geometric PMF</button>
        </form>

        <form id="f-exp" class="grid grid-cols-2 gap-2 items-end">
          <label class="text-sm">λ<input class="border p-2 rounded w-full" name="lam" value="0.5"></label>
          <label class="text-sm">x<input class="border p-2 rounded w-full" name="x" value="2"></label>
          <button class="px-3 py-2 rounded bg-slate-900 text-white col-span-2" type="submit">Exponential CDF</button>
        </form>

        <form id="f-unif" class="grid grid-cols-4 gap-2 items-end">
          <label class="text-sm">a<input class="border p-2 rounded w-full" name="a" value="0"></label>
          <label class="text-sm">b<input class="border p-2 rounded w-full" name="b" value="10"></label>
          <label class="text-sm">x<input class="border p-2 rounded w-full" name="x" value="4"></label>
          <button class="px-3 py-2 rounded bg-slate-900 text-white col-span-4" type="submit">Uniform CDF</button>
        </form>

        <div class="mt-3 text-xs"><pre id="r-other" class="whitespace-pre-wrap break-all"></pre></div>
      </div>

      <!-- CLT -->
      <div class="p-4 rounded-xl bg-white shadow">
        <h3 class="font-semibold mb-3">CLT helper (P(lower ≤ X̄ ≤ upper))</h3>
        <form id="f-clt" class="grid grid-cols-5 gap-2 items-end">
          <label class="text-sm">μ<input class="border p-2 rounded w-full" name="mu" value="50"></label>
          <label class="text-sm">σ<input class="border p-2 rounded w-full" name="sigma" value="10"></label>
          <label class="text-sm">n<input class="border p-2 rounded w-full" name="n" value="36"></label>
          <label class="text-sm">lower<input class="border p-2 rounded w-full" name="lower" value="48"></label>
          <label class="text-sm">upper<input class="border p-2 rounded w-full" name="upper" value="54"></label>
          <button class="px-3 py-2 rounded bg-slate-900 text-white col-span-5" type="submit">Compute</button>
        </form>
        <div class="mt-3 text-xs"><pre id="r-clt" class="whitespace-pre-wrap break-all"></pre></div>
      </div>

      <!-- JOINT -->
      <div class="p-4 rounded-xl bg-white shadow">
        <h3 class="font-semibold mb-2">Joint (discrete)</h3>
        <p class="text-xs text-slate-500 mb-2">pairs: x,y,p;... (sum to 1)</p>
        <form id="f-joint" class="">
          <input class="border p-2 rounded w-full" name="pairs"
                 value="0,0,0.1;0,1,0.2;1,0,0.3;1,1,0.4">
          <button class="mt-3 px-3 py-2 rounded bg-slate-900 text-white">Compute</button>
        </form>
        <pre id="r-joint" class="mt-3 text-xs whitespace-pre-wrap break-all"></pre>
      </div>

    </section>
  </main>

  <!-- ABOUT MODAL -->
  <div id="about-overlay" class="fixed inset-0 bg-black/50 hidden" aria-hidden="true"></div>
  <div id="about-modal" role="dialog" aria-modal="true" aria-labelledby="about-title"
       class="fixed inset-0 hidden place-items-center p-4">
    <div class="bg-white rounded-2xl shadow-xl max-w-lg w-full p-6">
      <div class="flex items-center justify-between mb-2">
        <h2 id="about-title" class="text-xl font-bold">About probplots-web</h2>
        <button id="about-close" class="w-8 h-8 rounded-full bg-slate-900 text-white grid place-items-center"
                aria-label="Close About">✕</button>
      </div>
      <p class="text-sm text-slate-600 mb-4">DLBDSS helper: quick probability functions, plots, and a discrete joint distribution tool.</p>
      <div class="grid gap-2 text-sm">
        <div><span class="font-semibold">Version:</span> 0.2</div>
        <div><span class="font-semibold">Bind:</span> 127.0.0.1:5009 (proxied by Nginx)</div>
        <div><span class="font-semibold">Endpoints:</span> /api/norm/*, /api/binom/*, /api/pois/cdf, /api/geom/pmf, /api/exp/cdf, /api/unif/cdf, /api/clt, /api/joint, /plot/*, /healthz</div>
        <div><span class="font-semibold">Repo:</span> <a class="underline" href="https://github.com/hexawulf/probplots-web">hexawulf/probplots-web</a></div>
      </div>
      <div class="mt-4 text-right">
        <button id="about-ok" class="px-4 py-2 rounded bg-slate-900 text-white">Close</button>
      </div>
    </div>
  </div>

  <script>
  async function jfetch(url){ const r = await fetch(url); if(!r.ok) throw new Error(await r.text()); return r.json(); }
  function qs(id){ return document.getElementById(id); }

  // About modal
  const overlay = qs('about-overlay'), modal = qs('about-modal');
  function openAbout(){ overlay.classList.remove('hidden'); modal.classList.remove('hidden'); }
  function closeAbout(){ overlay.classList.add('hidden'); modal.classList.add('hidden'); }
  qs('btn-about').addEventListener('click', openAbout);
  qs('about-close').addEventListener('click', closeAbout);
  qs('about-ok').addEventListener('click', closeAbout);
  overlay.addEventListener('click', closeAbout);
  window.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeAbout(); });

  // Normal
  qs('f-ncdf').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const q = new URLSearchParams(new FormData(e.target));
    qs('r-norm').textContent = JSON.stringify(await jfetch('/api/norm/cdf?' + q.toString()), null, 2);
  });
  qs('f-ninv').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const q = new URLSearchParams(new FormData(e.target));
    qs('r-norm').textContent = JSON.stringify(await jfetch('/api/norm/inv?' + q.toString()), null, 2);
  });
  qs('btn-npdf').addEventListener('click', async ()=>{
    const mu = new URLSearchParams(new FormData(qs('f-ncdf'))).get('mu') ?? 0;
    const sigma = new URLSearchParams(new FormData(qs('f-ncdf'))).get('sigma') ?? 1;
    const r = await fetch(`/plot/pdf/normal?mu=${mu}&sigma=${sigma}`);
    const blob = await r.blob(); const img = qs('img-npdf');
    img.src = URL.createObjectURL(blob); img.classList.remove('hidden');
  });

  // Binomial
  qs('f-bpmf').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const q = new URLSearchParams(new FormData(e.target));
    qs('r-binom').textContent = JSON.stringify(await jfetch('/api/binom/pmf?' + q.toString()), null, 2);
  });
  qs('f-bcdf').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const q = new URLSearchParams(new FormData(e.target));
    qs('r-binom').textContent = JSON.stringify(await jfetch('/api/binom/cdf?' + q.toString()), null, 2);
  });
  qs('f-bcdf-range').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const q = new URLSearchParams(new FormData(e.target));
    qs('r-binom').textContent = JSON.stringify(await jfetch('/api/binom/cdf-range?' + q.toString()), null, 2);
  });
  qs('btn-binom-sim').addEventListener('click', async ()=>{
    const params = new URLSearchParams(new FormData(qs('f-bpmf')));
    const N = params.get('n') ?? 20;
    const p = params.get('p') ?? 0.5;
    const r = await fetch(`/plot/sim/binom?n=50000&N=${encodeURIComponent(N)}&p=${encodeURIComponent(p)}&bins=50`);
    const blob = await r.blob(); const img = qs('img-binom');
    img.src = URL.createObjectURL(blob); img.classList.remove('hidden');
  });

  // Poisson
  qs('f-ppmf').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const q = new URLSearchParams(new FormData(e.target));
    const cdf = await jfetch('/api/pois/cdf?' + q.toString());
    qs('r-pois').textContent = JSON.stringify({cdf}, null, 2);
  });
  qs('btn-pois-sim').addEventListener('click', async ()=>{
    const lam = new URLSearchParams(new FormData(qs('f-ppmf'))).get('lam') ?? 3;
    const r = await fetch(`/plot/sim/poisson?n=50000&lam=${encodeURIComponent(lam)}&bins=50`);
    const blob = await r.blob(); const img = qs('img-pois');
    img.src = URL.createObjectURL(blob); img.classList.remove('hidden');
  });

  // Geometric / Exponential / Uniform
  qs('f-geom').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const q = new URLSearchParams(new FormData(e.target));
    const out = await jfetch('/api/geom/pmf?' + q.toString());
    qs('r-other').textContent = JSON.stringify({geom_pmf: out.value}, null, 2);
  });
  qs('f-exp').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const q = new URLSearchParams(new FormData(e.target));
    const out = await jfetch('/api/exp/cdf?' + q.toString());
    qs('r-other').textContent = JSON.stringify({exp_cdf: out.value}, null, 2);
  });
  qs('f-unif').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const q = new URLSearchParams(new FormData(e.target));
    const out = await jfetch('/api/unif/cdf?' + q.toString());
    qs('r-other').textContent = JSON.stringify({unif_cdf: out.value}, null, 2);
  });

  // CLT
  qs('f-clt').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const q = new URLSearchParams(new FormData(e.target));
    qs('r-clt').textContent = JSON.stringify(await jfetch('/api/clt?' + q.toString()), null, 2);
  });

  // Joint
  qs('f-joint').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const q = new URLSearchParams(new FormData(e.target));
    const r = await fetch('/api/joint?' + q.toString());
    qs('r-joint').textContent = r.ok ? JSON.stringify(await r.json(), null, 2) : ('Error: ' + await r.text());
  });
  </script>
</body>
</html>
